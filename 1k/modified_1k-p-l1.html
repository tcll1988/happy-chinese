<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒŸãƒ‹ç·´ç¿’ï¼ˆæ—¥æœ¬èªã®æ„å‘³ã«å¾“ã„ã€é¸æŠç·´ç¿’ï¼‰</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    h1, h2 {
      color: #333333;
    }
    .exercise {
      background-color: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: opacity 0.5s ease-in-out;
    }
    .exercise p {
      font-size: 18px;
      line-height: 1.5;
    }
    select {
      margin: 10px;
      padding: 5px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 5px;
      transition: border-color 0.3s ease-in-out;
    }
    select:focus {
      border-color: #003366;
      outline: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      transition: transform 0.3s ease-in-out, background-color 0.3s ease-in-out;
    }
    button:hover {
      background-color: #45a049;
      transform: scale(1.05);
    }
    .result {
      margin-top: 20px;
      font-size: 18px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    .animation {
      margin-top: 20px;
      font-size: 24px;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .back-button {
      margin-top: 20px;
      background-color: #003366;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ãƒŸãƒ‹ç·´ç¿’ï¼ˆæ—¥æœ¬èªã®æ„å‘³ã«å¾“ã„ã€é¸æŠç·´ç¿’ï¼‰</h1>
    
    <!-- ç»ƒä¹ åŒºåŸŸ -->
    <div class="exercise" id="exercise">
      <h2 id="question-title">å•é¡Œ</h2>
      <p id="question-text"></p>
      
      <!-- ç¡®è®¤æŒ‰é’® -->
      <button id="confirm-button" onclick="checkAnswer()">ç¢ºèªã™ã‚‹</button>
    </div>
    
    <!-- ç»“æœåé¦ˆ -->
    <div class="result" id="result"></div>
    
    <!-- åŠ¨ç”»å’Œè¿”å›æŒ‰é’® -->
    <div class="animation" id="animation" style="display: none;">ğŸ‰</div>
    <button class="back-button" id="back-button" style="display: none;" onclick="location.href='æ›¿æ¢.html'">æˆ»ã‚‹</button>
  </div>

  <audio id="correct-sound" src="https://www.soundjay.com/button/beep-07.mp3" preload="auto"></audio>
  <audio id="wrong-sound" src="https://www.soundjay.com/button/beep-03.mp3" preload="auto"></audio>

  <script>
    // é¢˜ç›®æ•°æ®
    const questions = [
      {
        japanese: "ç§ã¯æã§ã€æå„ªã¨è¨€ã„ã¾ã™ã€‚",
        chinese: "æˆ‘ï¼ˆã€€ï¼‰æï¼Œï¼ˆã€€ï¼‰æä¼˜ã€‚",
        options1: ["å§“", "å", "å¥½", "æ˜"],
        options2: ["å«", "å§“", "å¥½", "æ˜"],
        answers: ["å§“", "å«"],
      },
      {
        japanese: "ç§ã¯å±±æœ¬æ˜ã¨è¨€ã„ã¾ã™ã€‚ã“ã‚“ã«ã¡ã¯ï¼",
        chinese: "æˆ‘ï¼ˆã€€ï¼‰å±±æœ¬æ˜ï¼Œä½ ï¼ˆã€€ï¼‰ï¼",
        options1: ["å«", "å§“", "å¥½", "æ˜"],
        options2: ["å¥½", "å§“", "å«", "æ˜"],
        answers: ["å«", "å¥½"],
      },
    ];

    // é¼“åŠ±è¯è¯­
    const encouragementMessages = [
      "ç´ æ™´ã‚‰ã—ã„ï¼ã‚ˆãã§ãã¾ã—ãŸï¼",
      "å®Œç’§ã§ã™ï¼æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼",
      "ã™ã”ã„ï¼ã‚ãªãŸã¯å¤©æ‰ã§ã™ã­ï¼",
    ];

    // åˆå§‹åŒ–å˜é‡
    let currentQuestionIndex = -1;
    let remainingQuestions = [...questions]; // å‰©ä½™é¢˜ç›®

    // æ˜¾ç¤ºéšæœºé¢˜ç›®
    function showRandomQuestion() {
      if (remainingQuestions.length === 0) {
        // æ‰€æœ‰é¢˜ç›®å®Œæˆ
        document.getElementById('exercise').style.display = 'none';
        document.getElementById('result').innerHTML = `<span style="color: green;">${getRandomEncouragementMessage()}</span>`;
        document.getElementById('animation').style.display = 'block';
        document.getElementById('back-button').style.display = 'inline-block';
        return;
      }

      // éšæœºé€‰æ‹©ä¸€é“é¢˜
      const randomIndex = Math.floor(Math.random() * remainingQuestions.length);
      const question = remainingQuestions[randomIndex];
      currentQuestionIndex = randomIndex;

      // æ›´æ–°ç•Œé¢
      document.getElementById('question-title').innerText = "å•é¡Œ";

      // æ„å»ºé—®é¢˜æ–‡æœ¬å’Œä¸‹æ‹‰èœå•
      const questionText = question.chinese.replace("ï¼ˆã€€ï¼‰", `ï¼ˆ<select id="dropdown1">${createOptions(question.options1)}</select>ï¼‰`)
                                           .replace("ï¼ˆã€€ï¼‰", `ï¼ˆ<select id="dropdown2">${createOptions(question.options2)}</select>ï¼‰`);
      document.getElementById('question-text').innerHTML = questionText;

      // æ¸æ˜¾æ•ˆæœ
      document.getElementById('exercise').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('exercise').style.opacity = 1;
      }, 100);

      // æ¸…ç©ºç»“æœ
      document.getElementById('result').innerText = '';
      document.getElementById('result').style.opacity = 0;

      // æ˜¾ç¤ºç¡®è®¤æŒ‰é’®
      document.getElementById('confirm-button').style.display = 'inline-block';
    }

    // åˆ›å»ºä¸‹æ‹‰èœå•çš„é€‰é¡¹ï¼Œé»˜è®¤é€‰é¡¹ä¸ºç©ºç™½
    function createOptions(options) {
      return `<option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>` + 
             options.map(option => `<option value="${option}">${option}</option>`).join('');
    }

    // æ£€æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
      const dropdown1 = document.getElementById('dropdown1');
      const dropdown2 = document.getElementById('dropdown2');
      const selectedOption1 = dropdown1.value;
      const selectedOption2 = dropdown2.value;

      // æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†ç©ºç™½é€‰é¡¹
      if (!selectedOption1 || !selectedOption2) {
        document.getElementById('result').innerHTML = `
          <span style="color: red;">ã™ã¹ã¦ã®ç©ºã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</span>
        `;
        fadeInResult();
        return;
      }

      const correctAnswers = remainingQuestions[currentQuestionIndex].answers;
      const isCorrect1 = selectedOption1 === correctAnswers[0];
      const isCorrect2 = selectedOption2 === correctAnswers[1];

      // æ˜¾ç¤ºåé¦ˆ
      if (isCorrect1 && isCorrect2) {
        playSound('correct-sound');
        document.getElementById('result').innerHTML = `
          <span style="color: green;">æ­£è§£ã§ã™ï¼æ¬¡ã®å•é¡Œã«é€²ã¿ã¾ã™ã€‚</span>
        `;
        fadeInResult();
        setTimeout(() => {
          remainingQuestions.splice(currentQuestionIndex, 1); // ç§»é™¤å½“å‰é¢˜ç›®
          showRandomQuestion(); // æ˜¾ç¤ºä¸‹ä¸€é¢˜
        }, 1000);
      } else {
        playSound('wrong-sound');
        document.getElementById('result').innerHTML = `
          <span style="color: red;">ä¸æ­£è§£ã§ã™ã€‚æ­£ã—ã„ç­”ãˆã¯ã€Œ${correctAnswers[0]}ã€ã¨ã€Œ${correctAnswers[1]}ã€ã§ã™ã€‚</span>
          <br><button onclick="retryQuestion()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹</button>
        `;
        fadeInResult();
        // éšè—ç¡®è®¤æŒ‰é’®
        document.getElementById('confirm-button').style.display = 'none';
      }
    }

    // å†æ¬¡å°è¯•
    function retryQuestion() {
      // æ¸…ç©ºç»“æœ
      document.getElementById('result').innerText = '';

      // å¤ä½ä¸‹æ‹‰èœå•
      const dropdown1 = document.getElementById('dropdown1');
      const dropdown2 = document.getElementById('dropdown2');
      dropdown1.value = '';
      dropdown2.value = '';

      // æ˜¾ç¤ºç¡®è®¤æŒ‰é’®
      document.getElementById('confirm-button').style.display = 'inline-block';

      // æ¸æ˜¾æ•ˆæœ
      document.getElementById('exercise').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('exercise').style.opacity = 1;
      }, 100);
    }

    // è·å–éšæœºé¼“åŠ±è¯è¯­
    function getRandomEncouragementMessage() {
      const randomIndex = Math.floor(Math.random() * encouragementMessages.length);
      return encouragementMessages[randomIndex];
    }

    // æ’­æ”¾éŸ³æ•ˆ
    function playSound(soundId) {
      const sound = document.getElementById(soundId);
      sound.currentTime = 0; // é‡ç½®éŸ³æ•ˆ
      sound.play();
    }

    // æ¸æ˜¾ç»“æœ
    function fadeInResult() {
      document.getElementById('result').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('result').style.opacity = 1;
      }, 100);
    }

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¬¬ä¸€é“é¢˜
    window.onload = function() {
      showRandomQuestion();
    };
  </script>
</body>
</html>